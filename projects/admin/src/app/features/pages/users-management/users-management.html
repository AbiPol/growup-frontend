<main class="user-management-page p-6 space-y-8 animate-fade-in text-gray-900 dark:text-white">
    <!-- Header -->
    <header class="flex flex-col md:flex-row md:items-center justify-between gap-6">
        <div>
            <h1 class="text-4xl font-black text-gray-900 dark:text-white tracking-tight flex items-center gap-3">
                <i class="pi pi-users text-brand-500 text-3xl"></i>
                Gesti√≥n de Usuarios
            </h1>
            <p class="text-gray-500 dark:text-gray-400 mt-2 font-medium">Administra el acceso y roles de la plataforma
                GrowUp</p>
        </div>
        <div class="flex flex-wrap gap-4">
            <p-iconField iconPosition="left" class="w-full md:w-auto">
                <p-inputIcon class="pi pi-search" />
                <input type="text" pInputText placeholder="Buscar usuario..."
                    class="w-full md:w-72 rounded-2xl border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-sm"
                    #busqueda (input)="buscaUser(busqueda.value)" />
            </p-iconField>
            <p-button label="Exportar" icon="pi pi-download" severity="secondary" [outlined]="true"
                styleClass="rounded-2xl font-bold px-6" />
        </div>
    </header>


    <!-- Tabs View -->
    <section
        class="bg-white dark:bg-gray-800 rounded-[2.5rem] border border-gray-100 dark:border-gray-700 shadow-sm overflow-hidden"
        aria-label="Listado de usuarios por rol">
        <p-tabs value="0">
            <p-tablist class="px-8 pt-6 border-b border-gray-100 dark:border-gray-700">
                <p-tab value="0" class="flex items-center gap-3 py-4">
                    <i class="pi pi-graduation-cap text-lg"></i>
                    <span class="font-bold">Estudiantes</span>
                    <span
                        class="px-2.5 py-1 text-xs rounded-full bg-brand-50 dark:bg-brand-900/30 text-brand-600 dark:text-brand-400 font-black border border-brand-100 dark:border-brand-800">
                        {{ buscandoUser() ? studentsSearch().length : totalStudents() }}
                    </span>
                </p-tab>
                <p-tab value="1" class="flex items-center gap-3 py-4">
                    <i class="pi pi-briefcase text-lg"></i>
                    <span class="font-bold">Formadores</span>
                    <span
                        class="px-2.5 py-1 text-xs rounded-full bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 font-black border border-blue-100 dark:border-blue-800">
                        {{ buscandoUser() ? teachersSearch().length : totalTeachers() }}
                    </span>
                </p-tab>
            </p-tablist>

            <p-tabpanels class="p-8 pt-4">
                <!-- Students Panel -->
                <p-tabpanel value="0">
                    <p-table [value]="buscandoUser() ? studentsSearch() : students()" [rows]="10" [paginator]="true"
                        responsiveLayout="stack" breakpoint="960px" class="p-datatable-sm">
                        <ng-template pTemplate="header">
                            <tr class="text-gray-400 text-xs font-bold uppercase tracking-widest">
                                <th class="py-4">Usuario</th>
                                <th class="py-4">Email</th>
                                <th class="py-4">Fecha Registro</th>
                                <th class="py-4">Estado</th>
                                <th class="py-4">Acciones</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-user>
                            <tr
                                class="border-b border-gray-50 dark:border-gray-700/50 hover:bg-gray-50/50 dark:hover:bg-gray-700/30 transition-colors">
                                <td class="py-4">
                                    <article class="flex items-center gap-3">
                                        <p-avatar [label]="user.name.charAt(0)"
                                            styleClass="bg-brand-100 dark:bg-brand-900/30 text-brand-700 dark:text-brand-400 font-black"
                                            shape="circle" />
                                        <span class="font-bold text-gray-900 dark:text-white">{{ user.name }}</span>
                                    </article>
                                </td>
                                <td class="py-4"><span class="text-gray-600 dark:text-gray-400 font-medium">{{
                                        user.email }}</span></td>
                                <td class="py-4"><span class="text-gray-500 dark:text-gray-500 text-sm font-medium">{{
                                        user.joinDate }}</span></td>
                                <td class="py-4">
                                    <p-tag [value]="user.isActive ? 'Activo' : 'Inactivo'"
                                        [severity]="getSeverity(user.isActive)"
                                        styleClass="rounded-full px-4 font-bold" />
                                </td>
                                <td class="py-4">
                                    <div class="flex gap-1">
                                        <p-button icon="pi pi-pencil" [text]="true" severity="secondary"
                                            pTooltip="Editar" tooltipPosition="bottom" (click)="showUserFicha(user)" />
                                        <p-button [icon]="user.isActive ? 'pi pi-user-minus' : 'pi pi-user-plus'"
                                            [text]="true" [severity]="user.isActive ? 'danger' : 'success'"
                                            (onClick)="toggleStatus(user.id)"
                                            [pTooltip]="user.isActive ? 'Desactivar' : 'Activar'"
                                            tooltipPosition="bottom" />
                                    </div>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </p-tabpanel>

                <!-- Teachers Panel -->
                <p-tabpanel value="1">
                    <p-table [value]="buscandoUser() ? teachersSearch() : teachers()" [rows]="10" [paginator]="true"
                        responsiveLayout="stack" breakpoint="960px" styleClass="p-datatable-sm">
                        <ng-template pTemplate="header">
                            <tr class="text-gray-400 text-xs font-bold uppercase tracking-widest">
                                <th class="py-4">Usuario</th>
                                <th class="py-4">Email</th>
                                <th class="py-4">Especialidad</th>
                                <th class="py-4">Estado</th>
                                <th class="py-4 text-right">Acciones</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-user>
                            <tr
                                class="border-b border-gray-50 dark:border-gray-700/50 hover:bg-gray-50/50 dark:hover:bg-gray-700/30 transition-colors">
                                <td class="py-4">
                                    <article class="flex items-center gap-3">
                                        <p-avatar [label]="user.name.charAt(0)"
                                            styleClass="bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 font-black"
                                            shape="circle" />
                                        <span class="font-bold text-gray-900 dark:text-white">{{ user.name }}</span>
                                    </article>
                                </td>
                                <td class="py-4"><span class="text-gray-600 dark:text-gray-400 font-medium">{{
                                        user.email }}</span></td>
                                <td class="py-4"><span
                                        class="text-gray-500 dark:text-gray-500 text-sm font-medium">Desarrollo
                                        Web</span></td>
                                <td class="py-4">
                                    <p-tag [value]="user.isActive ? 'Activo' : 'Inactivo'"
                                        [severity]="getSeverity(user.isActive)"
                                        styleClass="rounded-full px-4 font-bold" />
                                </td>
                                <td class="py-4">
                                    <div class="flex gap-1">
                                        <p-button icon="pi pi-pencil" [text]="true" severity="secondary"
                                            pTooltip="Editar" tooltipPosition="bottom" (click)="showUserFicha(user)" />
                                        <p-button [icon]="user.isActive ? 'pi pi-user-minus' : 'pi pi-user-plus'"
                                            [text]="true" [severity]="user.isActive ? 'danger' : 'success'"
                                            (onClick)="toggleStatus(user.id)"
                                            [pTooltip]="user.isActive ? 'Desactivar' : 'Activar'"
                                            tooltipPosition="bottom" />
                                    </div>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </p-tabpanel>
            </p-tabpanels>
        </p-tabs>
    </section>

    <p-dialog [(visible)]="displayFicha" [modal]="true" [draggable]="false" [resizable]="false"
        [header]="'Perfil de Usuario'" styleClass="ficha-dialog rounded-[3rem] overflow-hidden"
        [breakpoints]="{ '960px': '75vw', '641px': '90vw' }" [style]="{ width: '50vw' }">
        @if (selectedUser()) {
        <app-ficha-user [user]="selectedUser()!" (onClose)="closeUserFicha()" />
        }
    </p-dialog>
</main>