<main class="course-management-page p-6 lg:p-10 animate-fade-in bg-gray-50/30 dark:bg-transparent min-h-screen">
    <!-- Header Section -->
    <header class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-10">
        <div>
            <h1 class="text-4xl font-black text-gray-900 dark:text-white tracking-tight mb-2">Gestión de Cursos</h1>
            <p class="text-gray-500 dark:text-gray-400 font-medium">Administra el catálogo, precios e inventario de
                formación.</p>
        </div>
        <div class="flex items-center gap-3">
            <p-iconField iconPosition="left" class="w-full md:w-auto">
                <p-inputIcon class="pi pi-search" />
                <input type="text" pInputText placeholder="Buscar curso..."
                    class="w-full md:w-72 rounded-2xl border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-sm"
                    #search (input)="buscaCurso(search.value)" />
            </p-iconField>
            <!-- <p-button label="Nuevo Curso" icon="pi pi-plus"
                styleClass="bg-brand-600 border-none rounded-2xl px-6 font-bold shadow-lg shadow-brand-500/20" /> -->
        </div>
    </header>

    <!-- Courses Table -->
    <section
        class="bg-white dark:bg-gray-800/50 rounded-[2.5rem] shadow-xl shadow-gray-200/50 dark:shadow-none border border-gray-100 dark:border-gray-700/50 overflow-hidden">
        <p-table [value]="buscandoCurso()? coursesSearch(): courses()" [rows]="10" [paginator]="true"
            class="p-datatable-lg" responsiveLayout="stack" [breakpoint]="'960px'">
            <ng-template pTemplate="header">
                <tr class="bg-gray-50/50 dark:bg-gray-700/30">
                    <th class="py-5 pl-8 border-none text-xs font-bold uppercase tracking-widest text-gray-400">Curso
                    </th>
                    <th class="py-5 border-none text-xs font-bold uppercase tracking-widest text-gray-400">Instructor
                    </th>
                    <th class="py-5 border-none text-xs font-bold uppercase tracking-widest text-gray-400">Precio</th>
                    <th class="py-5 border-none text-xs font-bold uppercase tracking-widest text-gray-400 text-center">
                        Inscritos</th>
                    <th class="py-5 border-none text-xs font-bold uppercase tracking-widest text-gray-400">Estado</th>
                    <th
                        class="py-5 pr-8 border-none text-center text-xs font-bold uppercase tracking-widest text-gray-400">
                        Acciones</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-course>
                <tr
                    class="border-b border-gray-50 dark:border-gray-700/50 hover:bg-gray-50/50 dark:hover:bg-gray-700/30 transition-all group">
                    <td class="py-5 pl-8">
                        <div class="flex items-center gap-4">
                            <div
                                class="w-12 h-12 rounded-xl bg-gradient-to-br from-brand-500 to-blue-600 flex items-center justify-center text-white shadow-md">
                                <i class="pi pi-book text-xl"></i>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-gray-900 dark:text-white font-bold leading-tight">{{ course.name
                                    }}</span>
                                <span class="text-gray-400 dark:text-gray-500 text-xs">{{ course.category }} • {{
                                    course.level }}</span>
                            </div>
                        </div>
                    </td>
                    <td class="py-5">
                        <span class="text-gray-700 dark:text-gray-300 font-medium">{{ course.instructor.name }}</span>
                    </td>
                    <td class="py-5">
                        <div class="flex items-center gap-2">
                            <span class="text-lg font-black text-brand-600 dark:text-brand-400">{{ course.price |
                                currency:'EUR' }}</span>
                            <p-button icon="pi pi-pencil" [text]="true" severity="secondary"
                                styleClass="opacity-0 group-hover:opacity-100 transition-opacity"
                                (click)="openPriceEdit(course)" pTooltip="Editar Precio" />
                        </div>
                    </td>
                    <td class="py-5 text-center">
                        <growup-course-stats-card [count]="course.enrolledCount || 0" />
                    </td>
                    <td class="py-5">
                        <p-tag [value]="course.publicationStatus"
                            [severity]="getStatusSeverity(course.publicationStatus)"
                            class="rounded-full px-4 font-bold uppercase tracking-tighter text-[10px]" />
                    </td>
                    <td class="py-5 pr-8">
                        <div class="flex items-center justify-center">
                            <p-button icon="pi pi-eye" [text]="true" severity="secondary" (click)="showDetails(course)"
                                pTooltip="Previsualizar" />
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </section>

    <!-- Shared Preview & Approval Dialog -->
    <growup-course-preview-dialog [course]="selectedCourse()" [visible]="displayDetails()"
        (onClose)="displayDetails.set(false)" />

    <!-- Price Edit Dialog -->
    <p-dialog [(visible)]="displayPriceEdit" [modal]="true" [header]="'Editar Precio'" [style]="{width: '350px'}"
        styleClass="rounded-[2rem]">
        <div class="flex flex-col gap-4">
            <div class="p-4 bg-brand-50 dark:bg-brand-900/20 rounded-2xl border border-brand-100 dark:border-brand-800">
                <p class="text-xs font-bold text-brand-600 dark:text-brand-400 uppercase tracking-widest mb-1">Precio
                    Actual</p>
                <span class="text-2xl font-black text-brand-700 dark:text-brand-300 tracking-tight">{{
                    selectedCourse()?.price | currency:'EUR' }}</span>
            </div>

            <div class="space-y-1">
                <label class="text-xs font-bold text-gray-400 uppercase tracking-widest pl-1">Nuevo Precio (€)</label>
                <input type="number" pInputText [(ngModel)]="editingPrice"
                    class="w-full rounded-xl border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800" />
            </div>

            <div class="flex justify-end gap-2 mt-2">
                <p-button label="Cancelar" [text]="true" (click)="displayPriceEdit.set(false)" />
                <p-button label="Guardar" (click)="savePrice()" styleClass="bg-brand-600 border-none rounded-xl px-4" />
            </div>
        </div>
    </p-dialog>
</main>